(function(e){function t(t){for(var r,c,s=t[0],i=t[1],u=t[2],l=0,f=[];l<s.length;l++)c=s[l],Object.prototype.hasOwnProperty.call(a,c)&&a[c]&&f.push(a[c][0]),a[c]=0;for(r in i)Object.prototype.hasOwnProperty.call(i,r)&&(e[r]=i[r]);d&&d(t);while(f.length)f.shift()();return o.push.apply(o,u||[]),n()}function n(){for(var e,t=0;t<o.length;t++){for(var n=o[t],r=!0,s=1;s<n.length;s++){var i=n[s];0!==a[i]&&(r=!1)}r&&(o.splice(t--,1),e=c(c.s=n[0]))}return e}var r={},a={app:0},o=[];function c(t){if(r[t])return r[t].exports;var n=r[t]={i:t,l:!1,exports:{}};return e[t].call(n.exports,n,n.exports,c),n.l=!0,n.exports}c.m=e,c.c=r,c.d=function(e,t,n){c.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},c.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},c.t=function(e,t){if(1&t&&(e=c(e)),8&t)return e;if(4&t&&"object"===typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(c.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)c.d(n,r,function(t){return e[t]}.bind(null,r));return n},c.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return c.d(t,"a",t),t},c.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},c.p="";var s=window["webpackJsonp"]=window["webpackJsonp"]||[],i=s.push.bind(s);s.push=t,s=s.slice();for(var u=0;u<s.length;u++)t(s[u]);var d=i;o.push([0,"chunk-vendors"]),n()})({0:function(e,t,n){e.exports=n("56d7")},"09e3":function(e,t,n){"use strict";n("6c5b")},"275f":function(e,t,n){},"56d7":function(e,t,n){"use strict";n.r(t);n("e260"),n("e6cf"),n("cca6"),n("a79d");var r=n("7a23");function a(e,t,n,a,o,c){var s=Object(r["o"])("Home");return Object(r["j"])(),Object(r["c"])(s)}n("fb6a"),n("498a");var o={class:"home"},c={class:"home__tags"},s={class:"home__search"},i=Object(r["g"])(" Поиск: "),u={class:"home__cards"};function d(e,t,n,a,d,l){var f=Object(r["o"])("Tag"),p=Object(r["o"])("Card");return Object(r["j"])(),Object(r["e"])("div",o,[Object(r["f"])("div",c,[(Object(r["j"])(!0),Object(r["e"])(r["a"],null,Object(r["n"])(e.tags,(function(e){return Object(r["j"])(),Object(r["c"])(f,{onClick:function(t){return l.tagClickHandler(e)},tag:e,key:e.id,isActive:l.isActive(e.id)},null,8,["onClick","tag","isActive"])})),128))]),Object(r["f"])("div",s,[i,Object(r["s"])(Object(r["f"])("input",{class:"home__input",placeholder:"Введите название, описание, автора или год книги",type:"text","onUpdate:modelValue":t[0]||(t[0]=function(e){return d.filterInput=e}),onInput:t[1]||(t[1]=function(){return l.changeFilterHandler&&l.changeFilterHandler.apply(l,arguments)})},null,544),[[r["q"],d.filterInput]])]),Object(r["f"])("div",u,[(Object(r["j"])(!0),Object(r["e"])(r["a"],null,Object(r["n"])(l.computedCards.slice(0,this.showCount),(function(e,t){return Object(r["j"])(),Object(r["c"])(p,{card:e,key:t,search:d.filterInput.trim().toLowerCase()},null,8,["card","search"])})),128))]),e.existNextPage||l.computedCards.length>d.showCount?(Object(r["j"])(),Object(r["e"])("button",{key:0,onClick:t[2]||(t[2]=function(){return l.loadMoreButtonHandler&&l.loadMoreButtonHandler.apply(l,arguments)}),class:"home__button"}," Загрузить ещё ")):Object(r["d"])("",!0)])}var l=n("1da1"),f=n("2909"),p=n("5530"),h=(n("96cf"),n("4de4"),n("d3b7"),n("caad"),n("2532"),n("b0c0"),n("a4d3"),n("e01a"),n("a15b"),n("d81d"),n("c740"),n("99af"),n("7db0"),n("3ca3"),n("ddb0"),n("9861"),n("ac1f"),n("841c"),n("1276"),n("5502"));function b(e,t,n,a,o,c){return Object(r["j"])(),Object(r["e"])("div",{class:Object(r["i"])([{active:n.isActive},"tag"])},Object(r["p"])(n.tag.name),3)}var m={name:"Tag",props:{tag:Object,isActive:Boolean}},g=(n("be21"),n("6b0d")),j=n.n(g);const O=j()(m,[["render",b],["__scopeId","data-v-89d3720c"]]);var v=O,C={class:"card"},T=["innerHTML"],w=["innerHTML"],_=["innerHTML"];function x(e,t,n,a,o,c){var s=Object(r["o"])("CardModal");return Object(r["j"])(),Object(r["e"])("div",C,[Object(r["f"])("div",{class:"card__container",onClick:t[0]||(t[0]=function(){return c.cardClickHandler&&c.cardClickHandler.apply(c,arguments)})},[Object(r["f"])("div",{class:"card__name",innerHTML:c.name},null,8,T),Object(r["f"])("div",{class:"card__description",innerHTML:c.description.split(".")[0].length>100?c.description.split(".")[0]+".":c.description.split(".")[0]+"."+c.description.split(".")[1]+"."},null,8,w),Object(r["f"])("div",{class:"card__author",innerHTML:c.author+", "+c.year+"г."},null,8,_),o.showModal?(Object(r["j"])(),Object(r["c"])(s,{key:0,onCloseModal:c.closeModal,image:n.card.image,name:c.name,description:c.description,author:c.author,year:c.year},null,8,["onCloseModal","image","name","description","author","year"])):Object(r["d"])("",!0)])])}n("a434");var y=function(e){return Object(r["l"])("data-v-f6fac610"),e=e(),Object(r["k"])(),e},k={class:"cardModal__container"},M=y((function(){return Object(r["f"])("div",{class:"cardModal__close","data-modal":"close"},null,-1)})),H={class:"cardModal__picture"},S=["src"],P={class:"cardModal__content"},A=["innerHTML"],I=["innerHTML"],L=["innerHTML"];function D(e,t,n,a,o,c){return Object(r["j"])(),Object(r["e"])("div",{class:"cardModal",onClick:t[0]||(t[0]=function(){return c.closeModal&&c.closeModal.apply(c,arguments)}),"data-modal":"close"},[Object(r["f"])("div",k,[M,Object(r["f"])("div",H,[Object(r["f"])("img",{class:"cardModal__img",src:n.image,alt:""},null,8,S)]),Object(r["f"])("div",P,[Object(r["f"])("div",{class:"cardModal__name",innerHTML:n.name},null,8,A),Object(r["f"])("div",{class:"cardModal__description",innerHTML:n.description},null,8,I),Object(r["f"])("div",{class:"cardModal__author",innerHTML:n.author+", "+n.year+"г."},null,8,L)])])])}var R={name:"CardModal",props:{image:String,name:String,description:String,author:String,year:String},data:function(){return{}},methods:{closeModal:function(e){"close"===e.target.getAttribute("data-modal")&&this.$emit("closeModal")}}};n("948d");const E=j()(R,[["render",D],["__scopeId","data-v-f6fac610"]]);var G=E,N={name:"Card",components:{CardModal:G},props:{card:Object,isActive:Boolean,search:String},data:function(){return{showModal:!1}},methods:{cardClickHandler:function(){this.showModal=!0},closeModal:function(){var e=this;setTimeout((function(){e.showModal=!1}),0)},markText:function(e,t){var n=e,r=n.toLowerCase().indexOf(t),a=t.length;return r>=0&&a>0&&(n=n.split(""),n.splice(r+a,0,"</mark>"),n.splice(r,0,"<mark>"),n=n.join("")),n}},computed:{name:function(){return this.markText(this.card.name,this.search)},description:function(){return this.markText(this.card.description,this.search)},author:function(){return this.markText(this.card.author,this.search)},year:function(){return this.markText(this.card.year,this.search)}}};n("09e3");const B=j()(N,[["render",x],["__scopeId","data-v-99072cda"]]);var $=B,J={name:"Home",components:{Tag:v,Card:$},props:{},data:function(){return{selectedTags:[],filterInput:"",showCount:10}},computed:Object(p["a"])(Object(p["a"])({},Object(h["b"])({tags:"TAGS",cards:"CARDS",existNextPage:"GET_EXIST_NEXT_PAGE"})),{},{computedCards:function(){var e=this,t=this.cards.filter((function(t){return t.name.toLowerCase().includes(e.filterInput.trim().toLowerCase())||t.description.toLowerCase().includes(e.filterInput.trim().toLowerCase())||t.author.toLowerCase().includes(e.filterInput.trim().toLowerCase())||t.year.toLowerCase().includes(e.filterInput.trim().toLowerCase())}));return t}}),methods:{pushHystory:function(){history.pushState({},"","books?categories="+this.selectedTags.map((function(e){return e.id})).join(",")+"&search="+this.filterInput)},changeFilterHandler:function(){this.showCount=10,this.pushHystory()},tagClickHandler:function(e){var t=this.selectedTags.findIndex((function(t){return t.id===e.id}));this.selectedTags=t>=0?this.selectedTags.filter((function(t){return t.id!==e.id})):[].concat(Object(f["a"])(this.selectedTags),[e]),this.pushHystory()},loadMoreButtonHandler:function(){this.showCount=this.showCount+10,this.loadMoreCards()},loadMoreCards:function(){var e=this;return Object(l["a"])(regeneratorRuntime.mark((function t(){var n;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return n={categories:e.selectedTags.map((function(e){return e.id})),page:null},t.next=3,e.$store.dispatch("LOAD_MORE_CARDS",n);case 3:case"end":return t.stop()}}),t)})))()},isActive:function(e){return!!this.selectedTags.find((function(t){return t.id===e}))},getHystoryConfigs:function(){var e=new URLSearchParams(window.location.search),t=e.get("search"),n=e.get("categories").split(",");this.filterInput=t,this.selectedTags=this.tags.filter((function(e){return n.find((function(t){return+t===e.id}))}))}},watch:{selectedTags:function(e){var t={categories:e.map((function(e){return e.id})),page:1};this.$store.dispatch("GET_CARDS",t)}},mounted:function(){var e=this;return Object(l["a"])(regeneratorRuntime.mark((function t(){var n;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,e.$store.dispatch("GET_TAGS");case 2:return e.selectedTags=e.tags,n={categories:e.tags.map((function(e){return e.id})),page:1},t.next=6,e.$store.dispatch("GET_CARDS",n);case 6:setInterval((function(){e.computedCards.length<e.showCount&&e.loadMoreCards()}),300),e.getHystoryConfigs();case 8:case"end":return t.stop()}}),t)})))()}};n("d63b");const X=j()(J,[["render",d],["__scopeId","data-v-6f4cac5e"]]);var F=X,U=(n("275f"),{name:"App",components:{Home:F}});n("663f");const q=j()(U,[["render",a]]);var V=q,z=(n("e9c4"),"https://webdev.modumlab.com/api"),K=300,Q=function(e){return new Promise((function(t){return setTimeout(t,e)}))},W=Object(h["a"])({state:{tags:[],cards:[],page:1,existNextPage:!1,isCooledDown:!0},actions:{GET_TAGS:function(){var e=Object(l["a"])(regeneratorRuntime.mark((function e(t){var n,r,a,o,c;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(n=t.commit,r=t.dispatch,a=t.state,!a.isCooledDown){e.next=17;break}return e.next=4,fetch(z+"/book/categories",{method:"POST",headers:{"Content-Type":"application/json",Host:"webdev.modumlab.com"}});case 4:if(o=e.sent,!o.ok){e.next=12;break}return e.next=8,o.json();case 8:c=e.sent,n("setTags",Object(f["a"])(c.data.list)),e.next=13;break;case 12:alert("Ошибка HTTP: "+o.status);case 13:n("setIsCooledDown",!1),setTimeout((function(){n("setIsCooledDown",!0)}),K),e.next=20;break;case 17:return e.next=19,Q(50);case 19:r("GET_TAGS");case 20:case"end":return e.stop()}}),e)})));function t(t){return e.apply(this,arguments)}return t}(),GET_CARDS:function(){var e=Object(l["a"])(regeneratorRuntime.mark((function e(t,n){var r,a,o,c,s;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(r=t.commit,a=t.dispatch,o=t.state,!o.isCooledDown){e.next=21;break}return e.next=4,fetch(z+"/book/list",{method:"POST",headers:{"Content-Type":"application/json",Host:"webdev.modumlab.com"},body:JSON.stringify(n)});case 4:if(c=e.sent,!c.ok){e.next=14;break}return e.next=8,c.json();case 8:s=e.sent,r("setCards",Object(f["a"])(s.data.list)),r("setPage",s.data.page),r("setExistNextPage",s.data.next),e.next=17;break;case 14:r("setCards",[]),r("setPage",1),r("setExistNextPage",!1);case 17:r("setIsCooledDown",!1),setTimeout((function(){r("setIsCooledDown",!0)}),K),e.next=24;break;case 21:return e.next=23,Q(50);case 23:a("GET_CARDS",n);case 24:case"end":return e.stop()}}),e)})));function t(t,n){return e.apply(this,arguments)}return t}(),LOAD_MORE_CARDS:function(){var e=Object(l["a"])(regeneratorRuntime.mark((function e(t,n){var r,a,o,c,s,i;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(r=t.commit,a=t.dispatch,o=t.state,!o.isCooledDown){e.next=22;break}if(!o.existNextPage){e.next=18;break}return c=n,c.page=o.page+1,e.next=7,fetch(z+"/book/list",{method:"POST",headers:{"Content-Type":"application/json",Host:"webdev.modumlab.com"},body:JSON.stringify(c)});case 7:if(s=e.sent,!s.ok){e.next=17;break}return e.next=11,s.json();case 11:i=e.sent,r("addCards",Object(f["a"])(i.data.list)),r("setPage",i.data.page),r("setExistNextPage",i.data.next),e.next=18;break;case 17:alert("Ошибка HTTP: "+s.status);case 18:r("setIsCooledDown",!1),setTimeout((function(){r("setIsCooledDown",!0)}),K),e.next=25;break;case 22:return e.next=24,Q(50);case 24:a("LOAD_MORE_CARDS",n);case 25:case"end":return e.stop()}}),e)})));function t(t,n){return e.apply(this,arguments)}return t}()},mutations:{setTags:function(e,t){e.tags=Object(f["a"])(t)},setCards:function(e,t){e.cards=Object(f["a"])(t)},addCards:function(e,t){e.cards=[].concat(Object(f["a"])(e.cards),Object(f["a"])(t))},setPage:function(e,t){e.page=t},setExistNextPage:function(e,t){e.existNextPage=t},setIsCooledDown:function(e,t){e.isCooledDown=t}},getters:{TAGS:function(e){return e.tags},CARDS:function(e){return e.cards},GET_EXIST_NEXT_PAGE:function(e){return e.existNextPage}},modules:{}});Object(r["b"])(V).use(W).mount("#app")},"663f":function(e,t,n){"use strict";n("d963")},"6c5b":function(e,t,n){},8097:function(e,t,n){},"948d":function(e,t,n){"use strict";n("8097")},"9ec5":function(e,t,n){},be21:function(e,t,n){"use strict";n("9ec5")},d63b:function(e,t,n){"use strict";n("e9d8")},d963:function(e,t,n){},e9d8:function(e,t,n){}});
//# sourceMappingURL=app.2eedb6de.js.map